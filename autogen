#!/bin/sh
# rebuilds files generated by autoconf&automake.
# patches/autoconf.patch must have been applied.
# arguments are forwarded to the autoreconf script.

cd `dirname $0`

trap 'rm -rf .test-libtool' 1 2 15

# copied (removing [] quotes) from configure.in
	    rm -rf .test-libtool
	    mkdir .test-libtool
	    cd .test-libtool
	    cat >configure.in <<EOF
AM_PROG_LIBTOOL
EOF
	    aclocal >/dev/null 2>&1
	    if grep LIBTOOL aclocal.m4 >/dev/null 2>&1; then
		amanda_cv_libtool_macros=yes
	    else
		amanda_cv_libtool_macros=no
	    fi
	    cd ..
	    rm -rf .test-libtool

trap 'rm -f libtool/libtool.m4' 1 2 15

if [ "$amanda_cv_libtool_macros" = no ]; then
    ln config/libtool/libtool.m4 config
fi

autoreconf --foreign -l config "$@"

rm -f config/libtool.m4

exit 0
