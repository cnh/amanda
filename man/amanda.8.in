.\"
.TH AMANDA 8
.SH NAME
amanda \- Advanced Maryland Automatic Network Disk Archiver
.SH SYNOPSIS
.B amdump
.I config

.B amflush
.I [ -f ] config

.B amcleanup
.I config

.B amrestore
[ options ] 
.I tapedevice
[ 
.I hostname
[ 
.I diskname
]]

.B amlabel
.I config label

.B amcheck
.I [ -m ] [ -w ] config

.B amadmin
.I config 
.I command
[ command options ] 

.B amtape
.I config 
.I command
[ command options ] 

.B amverify
.I config

.B amrmtape
.I config

.SH DESCRIPTION

Amanda is the "Advanced Maryland Automatic Network Disk Archiver".
This manual page gives an overview of the Amanda commands and
configuration files for quick reference.

Here are all the Amanda commands.  Each one has its own manual page;
see those for all the gritty details.

.TP 
.B amdump
takes care of the nightly automatic Amanda backups.  It is normally
executed by 
.B cron 
on a computer called the 
.I master host.
.B Amdump
backs up all of the disks specified in the
.I disklist
file (discussed below) to tape or, if there is a problem, to a disk called the 
.I holding disk.  
Once all of the night's backups are performed, 
.B amdump
sends mail to the operators reporting on the night's failures and successes.

.TP 
.B amflush
flushes backups from the holding disk to tape.  
.B Amflush 
is only used after
.B amdump
has reported that it could not write the backups to tape for some
reason.  When this happens the backups go to the holding disk instead.
One of the operators must then correct the problem with the tape and
run
.B amflush.

.TP
.B amcleanup
cleans up after an interrupted
.B amdump.
This command is only needed if
.B amdump
was unable to complete for some reason, usually because the master
host crashed in the middle of the backups.

.TP
.B amrestore
reads backup files off of Amanda tapes, searching the tape for the
right backups.  
.B Amrestore
is suitable both for interactive restores of
single files, and the full restore of all partitions on a blown disk.

.TP
.B amlabel
writes special Amanda labels onto tapes.  
.B Amdump
will not write to an unlabeled tape, or to a labeled tape that should
not be overwritten (see TAPE MANAGEMENT below).

.TP
.B amcheck
verifies that the correct tape is in the Amanda tape drive.  Can
optionally be run through crontab such that operators will get mail
warning that the night's backups will fail unless corrective action is
taken.

.TP
.B amadmin
takes care of various administrative tasks, like finding out which
tapes are needed to restore a filesystem, forcing computers to do full
backups, and looking at schedule balance information.

.TP
.B amtape
takes care of various tape changer control operations, like loading
particular tapes from the tape rack into the drive, ejecting tapes,
and scanning the tape rack.

.TP
.B amverify
checks amanda backup tapes for errors; after scanning the tape a
report is sent (gnutar driven backup only).

.TP
.B amrmtape
deletes a tape as well from the
.I tapelist
as from the
.I curinfo
database.

.SH CONFIGURATION

There are three user-editable files that control the behaviour of Amanda.
The first is
.I amanda.conf,
the main config file.  This file contains a number of parameters
that you can use to customize Amanda for your site.  Second is the
.I disklist
file, which specifies the hosts and disk partitions to back up.
Third is the
.I tapelist
file, which lists the labeled tapes that are currently in active
rotation.  These files are described in more detail in the following
sections.

All the files are stored in a
.I config
directory under @CONFIG_DIR@.  Often a single site will have more than
one configuration; these configurations are named by the directories
that their config files are in.  For example, a site might have a
.I normal
configuration for every-day backups, and a
.I archive
configuration for 6-month full archival backups.  The config files for
these two would be stored under @CONFIG_DIR@/normal and
@CONFIG_DIR@/archive, respectively.

All log and database files generated by Amanda go in corresponding
directories under @LOG_DIR@ (log files) and @DB_DIR@ (database files).
In our example, the logs would go in @LOG_DIR@/normal and @LOG_DIR@/archive
(@DB_DIR@/normal and @DB_DIR@).

.SH CONFIG FILE PARAMETERS

There are a number of configuration parameters that control the
behavior of the Amanda programs.  All of them have default values, so
you need not specify the parameter in your
.I amanda.conf
if you like the default.

.TP
.B org
Default:
.I "YOUR ORG".
A descriptive name for your configuration.  This string is used for
the mail report.  It should be different for each different Amanda
configuration you have.

.TP
.B mailto
Default:
.I operators.
The list of recipients for the nightly mail report.

.TP
.B dumpcycle
Default:
.I 14.
The number of days in the backup cycle.  Each disk will get a full
backup in this many days.  This may be specified in weeks by adding
"weeks" after the number.

.TP
.B tapecycle
Default:
.I 15.
The number of tapes in your active tape cycle.  This number must be at
least one larger than your 
.B dumpcycle
parameter.  In practice you should have 5 or more slack days in the
tape schedule to allow time for schedule adjustments or disaster
recovery.

.TP
.B dumpuser
Default: 
.I bin.
The login name that Amanda uses to run the backups.  The slave hosts must
let the master host in as this user.

.TP
.B diskdir
Default:
.I /dumps/amanda.
The path name of the holding disk.  Backups are deposited under this
directory when no tape is available.

.TP
.B disksize
Default: 
.I 200.
The size of the holding disk available to Amanda, in megabytes.  

.TP
.B tapedev
Default:
.I /dev/rmt8.
The path name of the tape device file.

.TP
.B labelstr
Default:
.I .*.
The tape label constraint regular expression.  All tape labels
generated and used by this configuration must match the regular
expression.  If multiple configurations are run from the same master
host, it is helpful to constrain their labels to different strings
(for example, "DAILY[0-9]*" vs. "ARCHIVE[0-9]*") to avoid overwriting
each other's tapes.

.TP
.B tapetype
Default:
.I EXABYTE.
The type of tape drive in
.B tapedev.
This refers to one of the defined tapetypes in the config file, which
specify various tape parameters, like the
.B length,
.B filemark
size, and
.B speed
of the tape device.

.TP
.B netusage
Default:
.I 300.
The maximum network bandwidth allocated to Amanda, in Kbytes per second.

.TP
.B inparallel
Default:
.I 10.
The maximum number of backups that Amanda will attempt to run in
parallel.  Amanda will stay within the constraints of network
bandwidth and holding disk space available, so it doesn't hurt to set
this number a bit high.  Some contention can occur with larger numbers
of dumps, but this effect is relatively small on most systems.

.TP
.B bumpsize
Default:
.I 10 MB.
The minimum savings required to trigger an automatic
.I bump
from incremental level one to level two.  If Amanda determines that a
level two dump will be this much less than a level one, it will do a
level two.

.TP
.B bumpmult
Default:
.I 2.
The 
.I bump multiplier.
Amanda multiplies the
.I bumpsize
by this factor for each level.  This prevents active filesystems from
bumping too much by making it harder to bump to the next level.  For
example, with the default
.I bumpsize
and
.I bumpmult,
the bump threshold will be 10 MB for level one, 20 MB for level two,
40 MB for level three, and so on.

.TP
.B bumpdays
Default:
.I 2.
To insure redundancy in the dumps, Amanda will keep filesystems at the
same incremental level for at least
.I bumpdays
days, even if the bump threshold criteria are met.

.TP
.B diskfile
Default:
.I disklist.
The file name for the disklist file.

.TP
.B infofile
Default:
.I @DB_DIR@/curinfo.
The file name for the historical information database file.

.TP
.B logfile
Default:
.I @LOG_DIR@/log
The file name for the nightly log file.

.TP
.B tapefile
Default:
.I tapelist.
The file name for the active tape list file.


.SH DISKLIST FILE
The
.I disklist
file determines which disks will be backed up by Amanda.  Disks are
initially added to the file by the operators.
The disklist file contains a one-line entry per disk, of the
form:

.I hostname diskdevice dumptype

Lines starting with # are ignored, as are blank lines.  The fields
have the following meanings:

.TP
.B hostname
is the local name of the host to be backed up.

.TP
.B diskdevice
is the name of the disk device to be backed up, without the /dev/ prefix.

.TP
.B dumptype

refers to one of the dumptypes defined in the config file.  These
dumptypes specify various parameters, like whether or not to compress
the dumps, whether to record the dump results in /etc/dumpdates, and
the disk's relative priority.

.SH TAPE MANAGEMENT

The
.I tapelist
file contains the list of tapes that are in active rotation.  This
file is maintained entirely by Amanda and does not need to be created
or edited by the operators for normal operation.
It contains lines of the form:

.I		YYYYMMDD  LABEL

Where
.I YYYYMMDD
is the date that the tape was written, and
.I LABEL
is the user-supplied label of the tape, as written by the
.B amlabel
program.  This file is maintained by the Amanda programs and should
not be edited by hand.

Amanda will refuse to write to any unlabeled tape, or to a labeled
tape that is considered active and should not be overwritten.  There
need to be more tapes in active rotation than there are days in the
backup cycle to prevent the overwriting of a needed backup file when a
problem occurs.

.SH AUTHOR
James da Silva <jds@cs.umd.edu>
.br
University of Maryland, College Park

.SH "SEE ALSO"
amadmin(8), amdump(8), amflush(8), amcleanup(8), amrestore(8), amlabel(8), amcheck(8), dump(8)
