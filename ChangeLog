1998-06-08  Alexandre Oliva  <oliva@dcc.unicamp.br>

	* configure.in (amanda_cv_print_command): removed; using PRINT
 	instead.

1998-06-07 Todd Kover <kovert@omniscient.com>

	* add --with-owner option to allow installed binaries to be owned
	by someone other than the amanda user

	* add GB as valid holding disk size.

1998-06-07 Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* server-src/amadmin.c (info): don't need to specify an host.

	* server-src/amadmin.c (due): new due command to write when a
	filesystem is due ffor next level 0 or how much days it is
	overdue.

	* server-src/amstatus.pl.in (dump_size): new function to report
	the size of a dump split on multiple files.

1998-06-05 Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* recover-src/extract_list.c (read_buffer): write a message
	when amrecover timeout waiting for amrestore to send the dump.

1998-06-04  John R. Jackson  <jrj@purdue.edu>

	* client-src/getfsent.c (main): use a dynamically allocated string
	for the lookups since dev2rdev alters it on the fly and some systems
	drop core for trying to write into read only memory.  Also add the
	capability of passing additional lookups on the command line.

	* common-src/Makefile.am, common-src/file.c (main),
	common-src/token.c (main), server-src/conffile.c (dump_configuration,
	main), server-src/diskfile.c (main), server-src/infofile.c (main):
	Clean up compiler warnings in the test programs and make them all
	work again.

1998-06-03  Alexandre Oliva  <oliva@dcc.unicamp.br>

	* amplot/amplot.sh.in: modified command line argument parsing
 	mechanism, so as to prevent shell quoting problems and unportable
 	constructs.
	Reported by Chris Jones <cjones@clydesdale.math.montana.edu>

1998-06-02  John R. Jackson  <jrj@purdue.edu>

	* server-src/amcheck.c (main), server-src/reporter.c (main): make
	sure internal errors, such as the mail command failing, get
	reported.  In the case of amcheck, they go to stderr even if -m is
	set since there didn't seem to be anyplace better to do so and if
	this is running from a cron job it might get back to a real user.
	For reporter, the errors go to .../amdump along with everything
	else from the amdump script, and they should also go to .../log,
	except since it's reporter that's having the trouble, they probably
	will not make it into the mail report.

1998-06-01  John R. Jackson  <jrj@purdue.edu>

	* client-src/killpgrp.c: clean up minor compiler warnings by not
	building term_kill_{soft,hard} unless they are needed.

	* server-src/driverio.c (dumper_cmd): clean up compiler warning
	in printf format by forcing argument to always be long and using %ld.

	* server-src/driver.c: include <holding.h> to get declaration for
	unlink_holding_files and avoid a compiler warning.

	* common-src/amanda.h, common-src/match.c (validate_glob, match_glob,
	glob_to_regex), recover-src/amrecover.h, recover-src/extract_list.c
	(add_glob, add_regex, add_file, delete_glob, delete_regex,
	delete_file), recover-src/help.c (help_list), recover-src/uparse.y,
	recover-src/uscan.l, man/amrecover.8.in: add shell wildcard support
	for the add/delete amrecover commands.  Add addx/deletex commands
	that use regular expressions.  Support more characters in path names.

1998-06-01  Dan Swartzendruber  <dswartz@druber.com> via John R. Jackson

	* server-src/amlabel.c (main): check argc before referencing too
	far into argv for "-f".

1998-06-01  Alexandre Oliva  <oliva@dcc.unicamp.br>

	* docs/SYSTEM.NOTES: advise Linux users to use dump without
 	setuid/setgid

	* docs/INDEXING: update dumptype syntax

1998-05-29  John R. Jackson  <jrj@purdue.edu>

	* server-src/amindexd.c (uncompress_file, process_ls_dump,
	build_disk_table, is_dir_valid_opaque, opaque_ls): fix file
	descriptor leak, log the amadmin find command, fix error reporting
	from routines that do not generate system errors.
	* common-src/amanda.h: make sure errno is saved through amfree().

1998-05-28  Alexandre Oliva  <oliva@dcc.unicamp.br>

	* docs/SYSTEM.NOTES: GNU tar must be patched on HP/UX.
	* patches/tar-1.12.patch: ditto.

	* server-src/taper.c (endtape): do not log amount of used tape after 
	entering degraded mode.

	* client-src/sendsize.c (getsize_dump): pass at least argv[0] to
 	killpgrp.

1998-05-28  Paul R. Johnson  <prj@mit.edu>

	* client-src/sendbackup.c (check_status): when checking whether
	return status 1 is valid for dump, make sure it was *not* tar that
	was running.

1998-05-28  Tom Lear <toml@accesscom.com>, John R. Jackson  <jrj@purdue.edu>

	* man/amcheck.8.in: document new -Maddress command line flag.
	* server-src/amcheck.c (usage, main): add -Maddress command line
	flag to send mail to a specific address instead of mailto from
	amanda.conf.

1998-05-27  John R. Jackson  <jrj@purdue.edu>

	* man/amrestore.8: update for host/disk/date triplets.
	* recover-src/extract_list.c (extract_files_setup): pass datestamp
	argument in new position and without -d.
	* restore-src/amidxtaped.c (main): remove -d checks.
	* restore-src/amrestore.c (restore, usage, main): fix file descriptor
	leak, move datestamp to host/disk triplet and allow all to be repeated.

1998-05-27  Alexandre Oliva  <oliva@dcc.unicamp.br>

	* client-src/killpgrp.c (main): wait for either SIGTERM or EOF on
	stdin.

	* client-src/sendsize.c (getsize_dump): close the other end of
 	killpgrp's stdin pipe before trying to kill it, because we just
 	can't kill it.

	* configure.in (HAVE_HPUX_SCSI): check whether sys/scsi.h actually
	supports HP/UX-like changer commands.

	* config/acconfig.h (HAVE_HPUX_SCSI): indicates HP/UX-like changer
	interface is supported.

	* changer-src/scsi-hpux.c: check for HAVE_HPUX_SCSI instead of
 	HAVE_SYS_SCSI_H.

1998-05-25  Allen Briggs  <briggs@canolog.ninthwonder.com>

	* changer-src/chg-manual.sh.in (ONLINEREGEX): add `^er=0$' for
	NetBSD's mt

1998-05-23  Alexandre Oliva  <oliva@dcc.unicamp.br>

	* client-src/sendsize.c (getsize_dump): killpgrp must be direct
 	child of sendsize, otherwise sendsize won't be able to kill it.

1998-05-23  Alexandre Oliva  <oliva@dcc.unicamp.br>

	* configure.in (bcopy, bzero, fread, fwrite, vfprintf, vprintf,
	vsprintf): check for these in stdlib.h
	(memmove): check for it in strings.h
	
	* common-src/amanda.h (memmove): fix declaration of memmove, so as
 	to be compatible with the ones in common-src/memmove.c and
 	regex-src/fake/memmove.c
	
	reported by Tim Potter <tpot@acsys.anu.edu.au>

1998-05-20  Alexandre Oliva  <oliva@dcc.unicamp.br>

	* client-src/sendbackup.c (check_status): when checking whether dump 
	returned 1, make sure it was not tar; #ifdef'ed out the code that
	ignores exit status 2 from gnutar (will be compiled in only if
	IGNORE_TAR_ERRORS is defined)
	* client-src/sendbackup-gnutar.c (GNUTAR active filesystem errors): 
	updated comment; compile in GNUTAR error messages as DMP_NORMAL if
	IGNORE_TAR_ERRORS is defined; compile in SMBCLIENT error messages as 
	DMP_NORMAL if IGNORE_SMBCLIENT_ERRORS is defined.
	
1998-05-20  Tom Lear  <toml@accesscom.com>

	* client-src/sendbackup.h (tarpid): new variable, used to check
	whether it is gnutar that is running
	* client-src/sendbackup-gnutar.c (start_backup): set tarpid when
	starting gnutar
	* client-src/sendbackup.c (check_status): if gnutar returns 2,
	ignore the error

1998-05-19  Jean-Louis Martineau <martineau@IRO.UMontrealCA>

	* client-src/amandad.c: set parse_errmsg when unexpected packet
	* recover-src/amrecover.c: overflow in clean_pathname()
	* recover-src/extract_list.c: add log in delete_file().
	small bug when call clean_pathname()
	* server-src/amindexd.c: ORLD command is not working
	* server-src/dumper.c: fixe overflow

1998-05-17  Alexandre Oliva  <oliva@dcc.unicamp.br>

	* configure.in: do not check for MAXFILESIZE
	* config/acconfig.h: do not define MAXFILESIZE
	* server-src/conffile.c: use INT_MAX instead of MAXFILESIZE
	* example/amanda.conf.in: ditto

	* server-src/driver.c (interface_state): new function; print the
	free bandwidth for each interface.
	(short_dump_state): call interface_state before holdingdisk_state

	* ChangeLog: new file

Local Variables:
mode: change-log
left-margin: 8
fill-column: 76
End:
