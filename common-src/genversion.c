/*
 * Amanda, The Advanced Maryland Automatic Network Disk Archiver
 * Copyright (c) 1991,1993 University of Maryland
 * All Rights Reserved.
 *
 * Permission to use, copy, modify, distribute, and sell this software and its
 * documentation for any purpose is hereby granted without fee, provided that
 * the above copyright notice appear in all copies and that both that
 * copyright notice and this permission notice appear in supporting
 * documentation, and that the name of U.M. not be used in advertising or
 * publicity pertaining to distribution of the software without specific,
 * written prior permission.  U.M. makes no representations about the
 * suitability of this software for any purpose.  It is provided "as is"
 * without express or implied warranty.
 *
 * U.M. DISCLAIMS ALL WARRANTIES WITH REGARD TO THIS SOFTWARE, INCLUDING ALL
 * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS, IN NO EVENT SHALL U.M.
 * BE LIABLE FOR ANY SPECIAL, INDIRECT OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES
 * WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION
 * OF CONTRACT, NEGLIGENCE OR OTHER TORTIOUS ACTION, ARISING OUT OF OR IN
 * CONNECTION WITH THE USE OR PERFORMANCE OF THIS SOFTWARE.
 *
 * Author: James da Silva, Systems Design and Analysis Group
 *			   Computer Science Department
 *			   University of Maryland at College Park
 */
/*
 * genversion.c - dump the current Amanda version info.
 */
#include "amanda.h"
#include "version.h"

int main P((void));

#define MARGIN 	70

#define newline()				\
{						\
    printf("  \"%s\\n\",\n", line);		\
    *line = '\0', linelen = 0;			\
}

#define prstr(string)				\
{						\
    len = strlen(string);			\
    if(linelen+len >= MARGIN) { 		\
	newline(); 				\
	sprintf(line, "%*s", indent, "");	\
	linelen = indent;			\
    }						\
    strcat(line, (string)); linelen += len;	\
}

int main()
{
    char line[1024], str[256];
    int  linelen, indent, len;

    printf("/* version.c - generated by genversion.c - DO NOT EDIT! */\n");
    printf("char *version_info[] = {\n");

    *line = '\0', linelen = 0, indent = 0;
    prstr("build:"); indent = linelen;
    sprintf(str, " VERSION=\\\"Amanda-%d.%d.%d%s\\\"", VERSION_MAJOR,
    	VERSION_MINOR, VERSION_PATCH, VERSION_COMMENT); prstr(str);
#ifdef BUILT_DATE
    sprintf(str, " BUILT_DATE=\\\"%s\\\"", BUILT_DATE); prstr(str);
#endif
#ifdef BUILT_MACH
    sprintf(str, " BUILT_MACH=\\\"%s\\\"", BUILT_MACH); prstr(str);
#endif
#ifdef CC
    sprintf(str, " CC=\\\"%s\\\"", CC); prstr(str);
#endif
    newline();
    prstr("paths:"); indent = linelen;
#ifdef DEV_PREFIX
    sprintf(str, " DEV_PREFIX=\\\"%s\\\"", DEV_PREFIX); prstr(str);
#endif
#ifdef RDEV_PREFIX
    sprintf(str, " RDEV_PREFIX=\\\"%s\\\"", RDEV_PREFIX); prstr(str);
#endif
#ifdef DUMP
    sprintf(str, " DUMP=\\\"%s\\\"", DUMP); prstr(str);
#endif
#ifdef RESTORE
    sprintf(str, " RESTORE=\\\"%s\\\"", RESTORE); prstr(str);
#endif
#ifdef XFSDUMP
    sprintf(str, " XFSDUMP=\\\"%s\\\"", XFSDUMP); prstr(str);
#endif
#ifdef XFSRESTORE
    sprintf(str, " XFSRESTORE=\\\"%s\\\"", XFSRESTORE); prstr(str);
#endif
#ifdef VXDUMP
    sprintf(str, " VXDUMP=\\\"%s\\\"", VXDUMP); prstr(str);
#endif
#ifdef VXRESTORE
    sprintf(str, " VXRESTORE=\\\"%s\\\"", VXRESTORE); prstr(str);
#endif
#ifdef SAMBA_CLIENT
    sprintf(str, " SAMBA_CLIENT=\\\"%s\\\"", SAMBA_CLIENT); prstr(str);
#endif
#ifdef GNUTAR
    sprintf(str, " GNUTAR=\\\"%s\\\"", GNUTAR); prstr(str);
#endif
#ifdef COMPRESS_PATH
    sprintf(str, " COMPRESS_PATH=\\\"%s\\\"", COMPRESS_PATH); prstr(str);
#endif
#ifdef UNCOMPRESS_PATH
    sprintf(str, " UNCOMPRESS_PATH=\\\"%s\\\"", UNCOMPRESS_PATH); prstr(str);
#endif
    sprintf(str, " MAILER=\\\"%s\\\"", MAILER); prstr(str);
    sprintf(str, " bindir=\\\"%s\\\"", bindir); prstr(str);
    sprintf(str, " libexecdir=\\\"%s\\\"", libexecdir); prstr(str);
    sprintf(str, " CONFIG_DIR=\\\"%s\\\"", CONFIG_DIR); prstr(str);
    sprintf(str, " mandir=\\\"%s\\\"", mandir); prstr(str);
#ifdef GNUTAR_LISTED_INCREMENTAL_DIR
    sprintf(str, " listed_incr_dir=\\\"%s\\\"",
	    GNUTAR_LISTED_INCREMENTAL_DIR); prstr(str);
#endif
    newline();

    prstr("defs: ");
    indent = linelen;
    sprintf(str, " DEFAULT_SERVER=\\\"%s\\\"", DEFAULT_SERVER); prstr(str);
    sprintf(str, " DEFAULT_CONFIG=\\\"%s\\\"", DEFAULT_CONFIG); prstr(str);
    sprintf(str, " DEFAULT_TAPE_SERVER=\\\"%s\\\"", DEFAULT_TAPE_SERVER); prstr(str);
    sprintf(str, " DEFAULT_TAPE_DEVICE=\\\"%s\\\"", DEFAULT_TAPE_DEVICE); prstr(str);
    
#ifdef AIX_BACKUP
    prstr(" AIX_BACKUP");
#endif
#ifdef AIX_TAPEIO
    prstr(" AIX_TAPEIO");
#endif
#ifdef BROKEN_VOID
    prstr(" BROKEN_VOID");
#endif
#ifdef DUMP_RETURNS_1
    prstr(" DUMP_RETURNS_1");
#endif
#ifdef HAVE_MMAP
    prstr(" HAVE_MMAP");
#endif
#ifndef HAVE_STRERROR
    prstr(" NEED_STRERROR");
#endif
#ifndef HAVE_STRSTR
    prstr(" NEED_STRSTR");
#endif
#ifdef HAVE_SYSVSHM
    prstr(" HAVE_SYSVSHM");
#endif
#ifdef HAVE_POSIX_FCNTL
    prstr(" LOCKING=POSIX_FCNTL");
#endif
#ifdef HAVE_FLOCK
    prstr(" LOCKING=FLOCK");
#endif
#ifdef HAVE_LOCKF
    prstr(" LOCKING=LOCKF");
#endif
#ifdef HAVE_LNLOCK
    prstr(" LOCKING=LNLOCK");
#endif
#if !defined(HAVE_POSIX_FCNTL) && !defined(HAVE_FLOCK) && !defined(HAVE_LOCK) && !defined(HAVE_LNLOCK)
    prstr(" LOCKING=**NONE**");
#endif
#ifdef OSF1_VDUMP
    prstr(" OSF1_VDUMP");
#endif
#ifdef STATFS_BSD
    prstr(" STATFS_BSD");
#endif
#ifdef STATFS_OSF1
    prstr(" STATFS_OSF1");
#endif
#ifdef STATFS_ULTRIX
    prstr(" STATFS_ULTRIX");
#endif
#ifdef SETPGRP_VOID
    prstr(" SETPGRP_VOID");
#endif
#ifdef ASSERTIONS
    prstr(" ASSERTIONS");
#endif
#ifdef DEBUG_CODE
    prstr(" DEBUG_CODE");
#endif
#ifdef DEBUG_FILE_WITH_PID
    prstr(" DEBUG_FILE_WITH_PID");
#endif
#ifdef BSD_SECURITY
    prstr(" BSD_SECURITY");
#endif
#ifdef USE_AMANDAHOSTS
    prstr(" USE_AMANDAHOSTS");
#endif
#ifdef USE_RUNDUMP
    prstr(" USE_RUNDUMP");
#endif
#ifdef KRB4_SECURITY
#define HOSTNAME_INSTANCE	"<hostname>"
    prstr(" KRB4_SECURITY");
    sprintf(str, " SERVER_HOST_PRINCIPLE=\\\"%s\\\"", SERVER_HOST_PRINCIPLE);
    prstr(str);
    sprintf(str, " SERVER_HOST_INSTANCE=\\\"%s\\\"", SERVER_HOST_INSTANCE);
    prstr(str);
    sprintf(str, " SERVER_HOST_KEY_FILE=\\\"%s\\\"", SERVER_HOST_KEY_FILE);
    prstr(str);
    sprintf(str, " CLIENT_HOST_PRINCIPLE=\\\"%s\\\"", CLIENT_HOST_PRINCIPLE);
    prstr(str);
    sprintf(str, " CLIENT_HOST_INSTANCE=\\\"%s\\\"", CLIENT_HOST_INSTANCE);
    prstr(str);
    sprintf(str, " CLIENT_HOST_KEY_FILE=\\\"%s\\\"", CLIENT_HOST_KEY_FILE);
    prstr(str);
    sprintf(str, " TICKET_LIFETIME=%d", TICKET_LIFETIME);
    prstr(str);
#endif
#ifdef CLIENT_LOGIN
    sprintf(str, " CLIENT_LOGIN=\\\"%s\\\"", CLIENT_LOGIN);
    prstr(str);
#endif
#ifdef FORCE_USERID
    prstr(" FORCE_USERID");
#endif
#ifdef USE_VERSION_SUFFIXES
    prstr(" USE_VERSION_SUFFIXES");
#endif
#ifdef HAVE_GZIP
    prstr(" HAVE_GZIP");
#endif
#ifdef COMPRESS_SUFFIX
    sprintf(str, " COMPRESS_SUFFIX=\\\"%s\\\"", COMPRESS_SUFFIX);
    prstr(str);
#endif
#ifdef COMPRESS_FAST_OPT
    sprintf(str, " COMPRESS_FAST_OPT=\\\"%s\\\"", COMPRESS_FAST_OPT);
    prstr(str);
#endif
#ifdef COMPRESS_BEST_OPT
    sprintf(str, " COMPRESS_BEST_OPT=\\\"%s\\\"", COMPRESS_BEST_OPT);
    prstr(str);
#endif
#ifdef UNCOMPRESS_OPT
    sprintf(str, " UNCOMPRESS_OPT=\\\"%s\\\"", UNCOMPRESS_OPT);
    prstr(str);
#endif

    newline();

    printf("  0\n};\n");
    return 0;
}
