This file contains answers to some questions that are frequently asked
in the Amanda mailing lists, specially by new users.  Please take a
look at this file before posting, this can save us time that could be
spent improving Amanda and its documentation.

New entries and modifications are welcome; send them to
amanda-users@amanda.org or amanda-hackers@amanda.org.

You may also want to take a look at Oren Teich's Amanda FAQ Page,
http://ugrad-www.cs.colorado.edu/~teich/amanda

He is no longer maintaining that page, but it still contains useful
and accurate information.


Q: Why does `amdump' report that all disks failed?

A: Probably because the Amanda clients are not properly configured.
Before you ever run `amdump', make sure `amcheck' succeeds.  When it
does, so should `amdump'.

   Make sure you run `amcheck' as the same user that is supposed to
start `amdump', otherwise you may get incorrect results.


Q: Why does `amcheck' say `port NNN is not secure'?

A: Because `amcheck', as some other Amanda programs, must be installed
as setuid-root.  Run `make install' as `root', or `chown' all Amanda
setuid programs to `root', then `chmod u+s' them again, if `chown'
drops the setuid bit.


Q: Why does `amcheck' claim that the tape is `not an amanda tape'?

A: Because Amanda requires you to label tapes before it uses them.
Run `amlabel' in order to label a tape.

   If, even after labeling a tape, `amcheck' still complains about it,
make sure the regular expression specified in amanda.conf matches the
label you have specified, and check whether you have configured
non-rewinding tape devices for Amanda to use.  For example, use
/dev/nrst0 instead of /dev/rst0, /dev/rmt/0bn instead of /dev/rmt/0b,
or some other system-dependent device name that contains an `n',
instead of one that does not.  The `n' stands for non-rewinding.

   If you have labeled any tapes using the rewiding device
configuration, you'll have to label them again.


Q: Why does `amcheck' report `selfcheck timed out'?

A: This can occur under several different situations.  First, make
sure this problem is repeatable; if Amanda programs are
NFS-auto-mounted, some clients may fail to mount the Amanda binaries
in time.

   If the error is repeatable, log into the client, and check whether
the directory /tmp/amanda exists, and a file named /tmp/amandad.debug
exists in there: amandad will create this file whenever it starts.  If
this file does not exist, amandad is not starting properly, or it
lacks permission to create /tmp/amanda/amandad.debug.

   In the latter case, wipe out /tmp/amanda, and amandad should create
it next time it runs.  In the former case, check your inetd
configuration.  Make sure you have added the Amanda services to
/etc/services, that /etc/inetd.conf was properly configured, and that
you have signalled inetd to reread this file.  Check section 2.2 from
the INSTALL file for details.

   Pay special attention to typos in inetd.conf; error messages will
probably appear in /var/adm/messages if you have typed the amandad
program name incorrectly.  Make sure the same user that you have
specified at configure-time (--with-user=<USERNAME>) is listed in
inetd.conf.  Check whether this user has permission to run amandad, as
well as any shared libraries amandad depends upon, by running the
specified amandad command by hand, as the Amanda user.  If you type
anything, amandad should abort because it can't read a UDP packet
from the keyboard.

   As soon as you have properly configured inetd.conf so as to run
amandad, you should no longer get the `selfcheck timed out' message.


Q: Why does `amcheck' say `access as <username> not allowed...'

A: There must be something wrong with .amandahosts configuration (or
.rhosts, if you have not configured --with-amandahosts).

   First, if the <username> is not what you expect (i.e., not what you
have specified in the --with-user flag, at configure time), check the
inetd configuration file: you must have specified the wrong username
there.

   Make sure you specify a fully-qualified domain name in
.amandahosts/.rhosts; aliases are better avoided, for security
reasons.


Q: Why does `amcheck' report `ip address #.#.#.# is not in the ip list 
list for <hostname>'?

A: Check your DNS configuration tables.  In order to avoid
DNS-spoofing, Amanda double-checks hostname<->IP address mapping.  If
the IP address the request comes from maps to a hostname, but this
hostname does not map back to the incoming IP address, the request is
denied.


Q: Why does `amcheck' say `cannot overwrite active tape'?

A: Because, if you configure Amanda to use N tapes, by setting
tapecycle to N in `amanda.conf', before Amanda overwrites a tape, it
must write to at least other N-1 tapes.  Of course, Amanda will always
refuse to overwrite a tape marked for `noreuse' with `amadmin'.
Furthermore, such tapes are not counted when Amanda computes `N-1'
tapes.

   If, for some reason, you want to tell Amanda to overwrite a
particular tape, regardless of its position in the cycle, use
`amrmtape'.  This command will remove this tape from the `tapelist'
file, that is used to manage the tape cycle, and will delete
information about backups stored in that tape from the Amanda
database.


Q: Which tape changer configuration should I use in amanda.conf?

A: If you only have one tape unit, you have two choices: (i) don't use
a tape changer at all, i.e., set runtapes to 1, set tapedev to the
non-rewinding device corresponding to the tape unit, and comment out
tpchanger, changerfile and changerdev; or (ii) set up chg-manual, so
that you can change tapes manually.  If you select chg-manual, you
will not be able to start `amdump' as a cron job, and you should
always run `amflush -f', because chg-manual will ask you to press
return in the terminal where you started the controlling program.

   If you have several tape units, which you want to use to emulate a
tape changer, you want chg-multi.  Even if you do own a real tape
changer, that operates based on ejecting a tape or such, chg-multi may
be useful.  Other tape changers may require specialized changer
programs; read docs/TAPE.CHANGERS for details about the ones provided
with Amanda.


Q: How can I configure Amanda so that it performs full backups on the
week-end and incrementals on weekdays?

A: You can't.  Amanda doesn't work this way.  You just have to tell
Amanda how many tapes you have (tapecycle), and how often you want it
to perform full backups of each filesystem (dumpcycle).  It will
spread full backups along the dumpcycle, so you won't have any
full-only or incremental-only runs.


Q: What if my my tape unit uses expensive tapes, and I don't want to
use one tape per day?  Can't Amanda append to tapes?

A: It can't, and this is good.  Tape drives and OS drivers are
(in)famous for rewinding tapes at unexpected times, without telling
the program that's writing to them.  If you have a month's worth of
backups in that tape, you really don't want them to be overwritten, so
Amanda has taken the safe approach of requiring tapes to be written
from the beginning on every run.

   This can be wasteful, specially if you have a small amount of data
to back up, but expensive large-capacity tapes.  One possible approach
is to run amdump with tapes only, say once a week, to perform full
backups, and run it without tape on the other days, so that it
performs incremental backups and stores them in the holding disk.
Once or twice a week, you flush all backups in the holding disk to a
single tape.

   If you don't trust your holding disk, and you'd rather have all
your data on tapes daily, you can create an alternate configuration,
with two tapes, that backs up the holding disk only, always as a full
backup.  You'd run this configuration always after your regular
backup, so you always have a complete image of the holding disk on
tape, just in case it fails.


Q: How can I configure Amanda for long-term archiving?

A: The best approach is to create a separate configuration for your
archive backups.  It should use a separate set of tapes, and have all
dumptypes configured with `record no', so it doesn't interfere with
regular backups.


Q: Can Amanda span large filesystems across multiple tapes?

A: Not yet :-(

   This is an open project, looking for developers.  If you'd like to
help, please take a look at the Amanda Ongoing Projects Page, where
more up-to-date information is likely to be found about this project.

   The current work-around is to use GNU tar to back up subdirectories
of the huge filesystem separately.  But don't list too many of them:
if you do, the estimate request or the reply may not fit in a UDP
packet, and you'll get messages such as `missing estimates for' or
such, and these backups won't happen.  This is yet another known
limitation of Amanda; fixing it involves modifying the way estimate
requests are issued, so that no packet exceeds the maximum packet
size.


Q: Why does `amrecover' report `no index records'?

A: Probably because you have not enabled index generation in
amanda.conf.  The `index yes' option must be present in every dumptype
for whose disks indexes should be generated.

   Indexes are currently generated at backup-time only, so, if a
backup was performed without creating an index, you won't be able to
use `amrecover' to restore it, 'll have to use `amrestore'.


Q: Ok, I'm done with testing Amanda, now I want to put it in
production.  How can I reset its databases so as to start from
scratch?

A: First, remove the `curinfo' database.  By default, it is a
directory, but, if you have selected any other database format (don't,
they're deprecated), they may be files with extensions such as .dir
and .pag.

   Then, remove any log files from the log directory:
log.<TIMESTAMP>.<count> and amdump.<count>.  Finally, remove the
tapelist file, stored in the directory that contains amanda.conf,
unless amanda.conf specifies otherwise.  Depending on the tape changer
you have selected, you may also want to reset its state file.
