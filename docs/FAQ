This file contains answers to some questions that are frequently asked
in the Amanda mailing lists, specially by new users.  Please take a
look at this file before posting, this can save us time that could be
spent improving amanda and its documentation.

New entries and modifications are welcome; send them to
amanda-users@amanda.org or amanda-hackers@amanda.org.

You may also want to take a look at Oren Teich's Amanda FAQ Page,
http://ugrad-www.cs.colorado.edu/~teich/amanda

He is no longer maintaining that page, but it still contains useful
and accurate information.


Q: Why does `amdump' report that all disks failed?

A: Probably because the Amanda clients are not properly configured.
Before you ever run `amdump', make sure `amcheck' succeeds.  When it
does, so should `amdump'.

   Make sure you run `amcheck' as the same user that is supposed to
start `amdump', otherwise you may get incorrect results.


Q: Why does `amcheck' say `port NNN is not secure'?

A: Because `amcheck', as some other Amanda programs, must be installed
as setuid-root.  Run `make install' as `root', or `chown' all Amanda
setuid programs to `root', then `chmod u+s' them again, if `chown'
drops the setuid bit.


Q: Why does `amcheck' claim that the tape is `not an amanda tape'?

A: Because amanda requires you to label tapes before it uses them.
Run `amlabel' in order to label a tape.

   If, even after labeling a tape, `amcheck' still complains about it,
make sure the regular expression specified in amanda.conf matches the
label you have specified, and check whether you have configured
non-rewinding tape devices for amanda to use.  For example, use
/dev/nrst0 instead of /dev/rst0, /dev/rmt/0bn instead of /dev/rmt/0b,
or some other system-dependent device name that contains an `n',
instead of one that does not.  The `n' stands for non-rewinding.

   If you have labeled any tapes using the rewiding device
configuration, you'll have to label them again.


Q: Why does `amcheck' report `selfcheck timed out'?

A: This can occur under several different situations.  First, make
sure this problem is repeatable; if Amanda programs are
NFS-auto-mounted, some clients may fail to mount the Amanda binaries
in time.

   If the error is repeatable, log into the client, and check whether
the directory /tmp/amanda exists, and a file named /tmp/amandad.debug
exists in there: amandad will create this file whenever it starts.  If
this file does not exist, amandad is not starting properly, or it
lacks permission to create /tmp/amanda/amandad.debug.

   In the latter case, wipe out /tmp/amanda, and amandad should create
it next time it runs.  In the former case, check your inetd
configuration.  Make sure you have added the amanda services to
/etc/services, that /etc/inetd.conf was properly configured, and that
you have signalled inetd to reread this file.  Check section 2.2 from
the INSTALL file for details.

   Pay special attention to typos in inetd.conf; error messages will
probably appear in /var/adm/messages if you have typed the amandad
program name incorrectly.  Make sure the same user that you have
specified at configure-time (--with-user=<USERNAME>) is listed in
inetd.conf.  Check whether this user has permission to run amandad, as
well as any shared libraries amandad depends upon, by running the
specified amandad command by hand, as the amanda user.  If you type
anything, amandad should abort because it can't read an UDP packet
from the keyboard.

   As soon as you have properly configured inetd.conf so as to run
amandad, you should no longer get the `selfcheck timed out' message.


Q: Why does `amcheck' say `access as <username> not allowed...'

A: There must be something wrong with .amandahosts configuration (or
.rhosts, if you have not configured --with-amandahosts).

   First, if the <username> is not what you expect (i.e., not what you
have specified in the --with-user flag, at configure time), check the
inetd configuration file: you must have specified the wrong username
there.

   Make sure you specify a fully-qualified domain name in
.amandahosts/.rhosts; aliases are better avoided, for security
reasons.


Q: Why does `amcheck' report `ip address #.#.#.# is not in the ip list 
list for <hostname>'?

A: Check your DNS configuration tables.  In order to avoid
DNS-spoofing, amanda double-checks hostname<->IP address mapping.  If
the IP address the request comes from maps to a hostname, but this
hostname does not map back to the incoming IP address, the request is
denied.


Q: How can I configure amanda so that it performs full backups on the
week-end and incrementals on weekdays?

A: You can't.  Amanda doesn't work this way.  You just have to tell
Amanda how many tapes you have (tapecycle), and how often you want it
to perform full backups of each filesystem (dumpcycle).  It will
spread full backups along the dumpcycle, so you won't have any
full-only or incremental-only runs.


Q: What if my my tape unit uses expensive tapes, and I don't want to
use one tape per day?  Can't Amanda append to tapes?

A: It can't, and this is good.  Tape drives and OS drivers are
(in)famous for rewinding tapes at unexpected times, without telling
the program that's writing to them.  If you have a month's worth of
backups in that tape, you really don't want them to be overwritten, so
Amanda has taken the safe approach of requiring tapes to be written
from the beginning on every run.

   This can be wasteful, specially if you have a small amount of data
to back up, but expensive large-capacity tapes.  One possible approach
is to run amdump with tapes only, say once a week, to perform full
backups, and run it without tape on the other days, so that it
performs incremental backups and stores them in the holding disk.
Once or twice a week, you flush all backups in the holding disk to a
single tape.

   If you don't trust your holding disk, and you'd rather have all
your data on tapes daily, you can create an alternate configuration,
with two tapes, that backs up the holding disk only, always as a full
backup.  You'd run this configuration always after your regular
backup, so you always have a complete image of the holding disk on
tape, just in case it fails.


Q: How can I configure Amanda for long-term archiving?

A: The best approach is to create a separate configuration for your
archive backups.  It should use a separate set of tapes, and have all
dumptypes configured with `record no', so it doesn't interfere with
regular backups.
