$Id: KRB4,v 1.1 2003/03/29 23:59:06 kovert Exp $

Amanda 2.5.0 - KERBEROS v4 SUPPORT NOTES

1. CONFIGURATION

The configure script defaults to:

#  define SERVER_HOST_PRINCIPLE "amanda"
#  define SERVER_HOST_INSTANCE  ""
#  define SERVER_HOST_KEY_FILE  "/.amanda"

#  define CLIENT_HOST_PRINCIPLE "rcmd"
#  define CLIENT_HOST_INSTANCE  HOSTNAME_INSTANCE
#  define CLIENT_HOST_KEY_FILE  KEYFILE

#  define TICKET_LIFETIME       128

you can override these with configure options if you so desire, with:

    --with-server-principal=ARG    server host principal  [amanda]
     --with-server-instance=ARG     server host instance   []
     --with-server-keyfile=ARG      server host key file   [/.amanda]
     --with-client-principal=ARG    client host principal  [rcmd]
     --with-client-instance=ARG     client host instance   [HOSTNAME_INSTANCE]
     --with-client-keyfile=ARG      client host key file   [KEYFILE]
     --with-ticket-lifetime=ARG     ticket lifetime        [128]

The configure script will search under /usr/kerberos/lib,
/usr/cygnus/lib, /usr/lib, and /opt/kerberos/lib for libkrb.a.  (in
that order) for the kerberos bits.  If it finds them, kerberos support
will be added in, if it doesn't, it won't.  If the kerberos bits are
found under some other hierarchy, you can specify this via the
--with-krb4-security=DIR, where DIR is where the kerberos bits live.
It'll look under the 'lib' directory under this hierarchy for
libkrb.a.

2. INSTALLATION

The kerberized Amanda service uses a different port on the client hosts.
The /etc/services line is:

    kamanda      10081/udp

And the /etc/inetd.conf line is:

    kamanda dgram udp wait root /usr/local/libexec/amanda/amandad amandad -auth=krb4

Note that you're running this as root, rather than as your dump user.
Amanda will set it's uid down to the dump user at times it doesn't need
to read the srvtab file, and give up root permissions entirely before
it goes off and runs dump.  Alternately you can change your srvtab files
to be readable by user amanda.

3. CONF FILE

The following dumptype options apply to krb4:

	auth "krb4"	use krb4 auth for this host
			(you can mingle krb hosts & bsd .rhosts in one conf)
	kencrypt	encrypt this filesystem over the net using the krb4
			session key.  About 2x slower.  Good for those root
			partitions containing your keyfiles.  Don't want to
			give away the keys to an ethernet sniffer!
			This is currently always enabled.  There is no
			way to disable it.  This is a bug.
